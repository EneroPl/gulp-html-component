const fs=require("fs"),gutil=require("gulp-util"),through=require("through2"),Worker=require("./helpers/worker"),initialOptions={path:"./src",encoding:"utf8"};module.exports=(t=initialOptions)=>{let r=Worker(t);return through.obj(function(n,e,o){if(n.isNull()){o(null,n);return}if(n.isStream()){o(new gutil.PluginError("gulp-html-component","Streaming not supported"));return}try{r.components().forEach(({name:e,component:o})=>{let i=n.contents.toString().replace(RegExp(`<${e}(.*)?(\\/)?>(.*<\\/${e}>)?`,"gm"),t=>{if(n.contents.toString().includes(e))return r.useProps(o,r.parseProps(t))});n.contents=new Buffer.from(i,t.encoding)}),this.push(n),o()}catch(i){this.emit("error",i)}})};