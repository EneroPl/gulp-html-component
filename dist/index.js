const fs=require("fs"),gutil=require("gulp-util"),through=require("through2"),Worker=require("./helpers/worker"),initialOptions={path:"./src",encoding:"utf8"};module.exports=(t=initialOptions)=>{let r=Worker(t);return through.obj(function(e,n,o){if(e.isNull()){o(null,e);return}if(e.isStream()){o(new gutil.PluginError("gulp-html-component","Streaming not supported"));return}try{r.components().forEach(({name:n,component:o})=>{let i=e.contents.toString().replace(RegExp(`<${n}(.*)?(\\/)?>(.*<\\/${n}>)?`,"gm"),t=>{if(e.contents.toString().includes(n)){let i=r.parseListeners(t),s=r.parseProps(t),u=o;return u=r.useListeners(u,i),u=r.useProps(u,s)}});e.contents=new Buffer.from(i,t.encoding)}),this.push(e),o()}catch(i){this.emit("error",i)}})};